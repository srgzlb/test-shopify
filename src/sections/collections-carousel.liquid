{%- assign padding_top 				= section.settings.padding_top -%}
{%- assign padding_bottom 			= section.settings.padding_bottom -%}
{%- assign padding_top_mobile 		= section.settings.padding_top_mobile -%}
{%- assign padding_bottom_mobile 	= section.settings.padding_bottom_mobile -%}
{%- assign text_color 				= section.settings.text_color -%}
{%- assign title 					= section.settings.title -%}
{%- assign title_size 				= section.settings.title_size -%}
{%- assign products_limit 			= section.settings.products_limit -%}

{%- capture variables -%}
    --padding-top: {{ padding_top }}px;
    --padding-bottom: {{ padding_bottom }}px;
	--padding-top-mobile: {{ padding_top_mobile }}px;
    --padding-bottom-mobile: {{ padding_bottom_mobile }}px;
	--text-color: {{ text_color }};
{%- endcapture -%}

{%- if section.blocks.size > 0 -%}
    <div class="collection-carousel{% if padding_top != 0 or padding_top_mobile != 0 %} collection-carousel--padding-top{% endif %}{% if padding_bottom != 0 or padding_bottom_mobile != 0 %} collection-carousel--padding-bottom{% endif %}"
        data-section-id="{{ section.id }}"
        data-section-type="collection-carousel"
		style="{{- variables | escape -}}"
	>
	    <div class="collection-carousel__container container">
            {%- if title != blank -%}
                <div class="collection-carousel__header">
                    <h1 class="collection-carousel__title {{ title_size }}">
                        {{- title | replace: "p>", "span>" -}}
                    </h1>
                </div>
            {%- endif -%}

            <div class="collection-carousel__slider">
                <div class="collection-carousel__slider-container swiper-container slider__container js-collection-carousel-container">
                    <div class="collection-carousel__slider-wrapper swiper-wrapper slider__wrapper">
                        {%- for block in section.blocks limit: products_limit -%}
                            {%- assign collection = block.settings.collection -%}
                            {%- assign collection_title = block.settings.heading | default: collection.title -%}
                            {%- assign collection_description = block.settings.description | default: collection.description -%}
                            {%- assign collection_url = block.settings.button_link | default: collection.url -%}
                            {%- assign collection_label = block.settings.button_label -%}

                            {%- if collection.image -%}
                                {%- assign collection_image = collection.image -%}
                            {%- elsif collection.products.first and collection.products.first.images != empty -%}
                                {%- assign collection_image = collection.products.first.featured_image | default: placeholder_image -%}
                            {%- endif -%}

                            {%- capture collection_img -%}
                                <a href="{{ collection_url }}" class="collection-carousel__image-wrapper">
                                    {%- if collection_image != blank -%}
                                        <img
                                            class="collection-carousel__image"
                                            srcset="{{ collection_image | img_url: '535x' }} 1x, {{ collection_image | img_url: '1070x' }} 2x"
                                            src="{{ collection_image | img_url: '535x' }}"
                                            alt="{{ collection_image.alt | escape }}"
                                            loading="lazy"
                                            width="{{ collection_image.width }}"
                                            height="{{ collection_image.height }}"
                                        >
                                    {%- endif -%}
                                </a>
                            {%- endcapture -%}

                            {%- capture product_meta -%}
                                <div class="collection-carousel__card-header">
                                    <a href="{{ collection_url }}" class="collection-carousel__card-title h3">
                                        {{- collection_title -}}
                                    </a>

                                    {%- if collection_description -%}
                                        <div class="collection-carousel__card-description">
                                            {{- collection_description -}}
                                        </div>
                                    {%- endif -%}
                                </div>

                                {%- if collection_url -%}
                                    <div class="collection-carousel__cta">
                                        <a href="{{ collection_url }}" class="button button-primary collection-carousel__button">
                                            {%- if collection_label != blank -%}
                                                {{- collection_label -}}
                                            {%- else -%}
                                                {{- 'sections.collection_carousel.view_all' | t -}}
                                            {%- endif -%}
                                        </a>
                                    </div>
                                {%- endif -%}
                            {%- endcapture -%}

                            {%- if collection -%}
                                <div class="collection-carousel__slide swiper-slide slider__slide">
                                    <div class="collection-carousel__slide-content">
                                        <div class="collection-carousel__slide-media">
                                            {{- collection_img -}}
                                        </div>
                                        <div class="collection-carousel__slide-meta">
                                            {{- product_meta -}}
                                        </div>
                                    </div>
                                </div>
                            {%- endif -%}
                        {% endfor %}
                    </div>
                    <div class="collection-carousel__prev swiper-button-prev js-collection-carousel-prev">
                        {%- render 'icon-arrow' -%}
                    </div>
                    <div class="collection-carousel__next swiper-button-next js-collection-carousel-next">
                        {%- render 'icon-arrow' -%}
                    </div>
                </div>
            </div>
        </div>
    </div>
{%- endif -%}

{% schema -%}
    {
        "name": "t:sections.collection-carousel.name",
		"tag": "section",
		"class": "collection-carousel-section",
        "blocks": [
            {
                "type": "text",
                "name": "t:sections.collection-carousel.blocks.text.name",
                "settings": [
                    {
                        "type": "text",
                        "id": "heading",
                        "label": "t:sections.collection-carousel.blocks.text.settings.heading.label"
                    },
                    {
                        "type": "richtext",
                        "id": "description",
                        "label": "t:sections.collection-carousel.blocks.text.settings.description.label",
                        "default": "<p>Everything you need</p>"
                    },
                    {
                        "type": "url",
                        "id": "button_link",
                        "label": "t:sections.collection-carousel.blocks.text.settings.button_link.label"
                    },
                    {
                        "type": "text",
                        "id": "button_label",
                        "label": "t:sections.collection-carousel.blocks.text.settings.button_label.label"
                    },
                    {
                        "type": "collection",
                        "id": "collection",
                        "label": "t:sections.collection-carousel.blocks.text.settings.collection.label"
                    }
                ]
            }
        ],
        "settings": [
            {
                "type": "richtext",
                "id": "title",
                "label": "t:sections.collection-carousel.settings.title.label",
                "default": "<p>We have a scent for <em>everybody</em></p>"
            },
			{
				"type": "select",
				"id": "title_size",
				"options": [
					{
						"value": "h3",
						"label": "t:sections.all.heading_size.options__1.label"
					},
					{
						"value": "h2",
						"label": "t:sections.all.heading_size.options__2.label"
					},
					{
						"value": "h1",
						"label": "t:sections.all.heading_size.options__3.label"
					}
				],
				"default": "h2",
				"label": "t:sections.all.heading_size.label"
			},
			{
				"type": "color",
				"id": "text_color",
				"label": "t:sections.collection-carousel.settings.text_color.label",
				"default": "#000000"
			},
			{
				"type": "range",
				"id": "products_limit",
				"min": 4,
				"max": 10,
				"step": 1,
				"unit": "pcs",
				"label": "t:sections.collection-carousel.settings.products_limit.label",
				"default": 4
			},
            {
				"type": "header",
				"content": "t:sections.collection-carousel.settings.header.content"
			},
			{
				"type": "range",
				"id": "padding_top",
				"min": 0,
				"max": 100,
				"step": 1,
				"unit": "px",
				"label": "t:sections.all.padding.padding_top",
				"default": 40
			},
			{
				"type": "range",
				"id": "padding_bottom",
				"min": 0,
				"max": 100,
				"step": 1,
				"unit": "px",
				"label": "t:sections.all.padding.padding_bottom",
				"default": 40
			},
			{
				"type": "header",
				"content": "t:sections.collection-carousel.settings.header.content_mobile"
			},
			{
				"type": "range",
				"id": "padding_top_mobile",
				"min": 0,
				"max": 70,
				"step": 1,
				"unit": "px",
				"label": "t:sections.all.padding.padding_top",
				"default": 20
			},
			{
				"type": "range",
				"id": "padding_bottom_mobile",
				"min": 0,
				"max": 70,
				"step": 1,
				"unit": "px",
				"label": "t:sections.all.padding.padding_bottom",
				"default": 20
			}
        ],
        "presets": [
            {
                "name": "t:sections.collection-carousel.presets.name"
            }
        ]
    }
{% endschema %}
